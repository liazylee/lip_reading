import json



text = """
Epoch 1/100
450/450 [==============================] - 83s 179ms/step - loss: 84.0636 - val_loss: 70.1137 - lr: 1.0000e-04
Epoch 2/100
450/450 [==============================] - 80s 177ms/step - loss: 70.2815 - val_loss: 64.6625 - lr: 1.0000e-04
Epoch 3/100
450/450 [==============================] - 80s 178ms/step - loss: 66.4714 - val_loss: 61.7321 - lr: 1.0000e-04
Epoch 4/100
450/450 [==============================] - 80s 178ms/step - loss: 63.6546 - val_loss: 59.8281 - lr: 1.0000e-04
Epoch 5/100
450/450 [==============================] - 80s 177ms/step - loss: 61.6391 - val_loss: 58.9133 - lr: 1.0000e-04
Epoch 6/100
450/450 [==============================] - 80s 177ms/step - loss: 59.9946 - val_loss: 56.1460 - lr: 1.0000e-04
Epoch 7/100
450/450 [==============================] - 80s 177ms/step - loss: 57.8154 - val_loss: 52.0539 - lr: 1.0000e-04
Epoch 8/100
450/450 [==============================] - 80s 177ms/step - loss: 53.9593 - val_loss: 48.7219 - lr: 1.0000e-04
Epoch 9/100
450/450 [==============================] - 80s 177ms/step - loss: 51.9562 - val_loss: 49.5798 - lr: 1.0000e-04
Epoch 10/100
450/450 [==============================] - 80s 177ms/step - loss: 50.3332 - val_loss: 46.5991 - lr: 1.0000e-04
Epoch 11/100
450/450 [==============================] - 80s 177ms/step - loss: 48.1325 - val_loss: 44.0558 - lr: 1.0000e-04
Epoch 12/100
450/450 [==============================] - 80s 177ms/step - loss: 46.3308 - val_loss: 40.8469 - lr: 1.0000e-04
Epoch 13/100
450/450 [==============================] - 80s 177ms/step - loss: 44.4943 - val_loss: 38.9521 - lr: 1.0000e-04
Epoch 14/100
450/450 [==============================] - 80s 178ms/step - loss: 42.2014 - val_loss: 37.5908 - lr: 1.0000e-04
Epoch 15/100
450/450 [==============================] - 80s 178ms/step - loss: 39.9884 - val_loss: 34.5985 - lr: 1.0000e-04
Epoch 16/100
450/450 [==============================] - 80s 177ms/step - loss: 37.7546 - val_loss: 32.2313 - lr: 1.0000e-04
Epoch 17/100
450/450 [==============================] - 80s 178ms/step - loss: 35.6431 - val_loss: 30.3904 - lr: 1.0000e-04
Epoch 18/100
450/450 [==============================] - 80s 178ms/step - loss: 33.2062 - val_loss: 27.0394 - lr: 1.0000e-04
Epoch 19/100
450/450 [==============================] - 80s 177ms/step - loss: 31.2025 - val_loss: 25.6917 - lr: 1.0000e-04
Epoch 20/100
450/450 [==============================] - 80s 177ms/step - loss: 28.8983 - val_loss: 23.3667 - lr: 1.0000e-04
Epoch 21/100
450/450 [==============================] - 80s 178ms/step - loss: 26.8608 - val_loss: 21.7343 - lr: 1.0000e-04
Epoch 22/100
450/450 [==============================] - 80s 177ms/step - loss: 24.6367 - val_loss: 19.7287 - lr: 1.0000e-04
Epoch 23/100
450/450 [==============================] - 80s 177ms/step - loss: 22.2618 - val_loss: 16.8182 - lr: 1.0000e-04
Epoch 24/100
450/450 [==============================] - 80s 177ms/step - loss: 20.5518 - val_loss: 16.1602 - lr: 1.0000e-04
Epoch 25/100
450/450 [==============================] - 80s 177ms/step - loss: 19.0046 - val_loss: 14.3839 - lr: 1.0000e-04
Epoch 26/100
450/450 [==============================] - 80s 177ms/step - loss: 17.6778 - val_loss: 13.4689 - lr: 1.0000e-04
Epoch 27/100
450/450 [==============================] - 80s 177ms/step - loss: 16.4729 - val_loss: 12.0194 - lr: 1.0000e-04
Epoch 28/100
450/450 [==============================] - 80s 177ms/step - loss: 15.2860 - val_loss: 11.4336 - lr: 1.0000e-04
Epoch 29/100
450/450 [==============================] - 80s 177ms/step - loss: 14.4296 - val_loss: 9.7577 - lr: 1.0000e-04
Epoch 30/100
450/450 [==============================] - 80s 178ms/step - loss: 13.3768 - val_loss: 9.2587 - lr: 1.0000e-04
Epoch 31/100
450/450 [==============================] - 80s 177ms/step - loss: 12.2746 - val_loss: 9.0447 - lr: 9.0484e-05
Epoch 32/100
450/450 [==============================] - 80s 178ms/step - loss: 11.2802 - val_loss: 8.7373 - lr: 8.1873e-05
Epoch 33/100
450/450 [==============================] - 80s 178ms/step - loss: 10.5796 - val_loss: 7.5372 - lr: 7.4082e-05
Epoch 34/100
450/450 [==============================] - 80s 178ms/step - loss: 9.9854 - val_loss: 6.8139 - lr: 6.7032e-05
Epoch 35/100
450/450 [==============================] - 80s 177ms/step - loss: 9.3555 - val_loss: 6.4640 - lr: 6.0653e-05
Epoch 36/100
450/450 [==============================] - 80s 177ms/step - loss: 8.8573 - val_loss: 5.6368 - lr: 5.4881e-05
Epoch 37/100
450/450 [==============================] - 80s 177ms/step - loss: 8.3767 - val_loss: 5.6837 - lr: 4.9659e-05
Epoch 38/100
450/450 [==============================] - 80s 177ms/step - loss: 7.9252 - val_loss: 5.2442 - lr: 4.4933e-05
Epoch 39/100
450/450 [==============================] - 80s 177ms/step - loss: 7.5109 - val_loss: 4.6574 - lr: 4.0657e-05
Epoch 40/100
450/450 [==============================] - 80s 177ms/step - loss: 7.2437 - val_loss: 4.6704 - lr: 3.6788e-05
Epoch 41/100
450/450 [==============================] - 80s 177ms/step - loss: 7.0408 - val_loss: 4.5200 - lr: 3.3287e-05
Epoch 42/100
450/450 [==============================] - 80s 177ms/step - loss: 6.6201 - val_loss: 3.9347 - lr: 3.0119e-05
Epoch 43/100
450/450 [==============================] - 80s 177ms/step - loss: 6.5030 - val_loss: 4.1338 - lr: 2.7253e-05
Epoch 44/100
450/450 [==============================] - 80s 177ms/step - loss: 6.2136 - val_loss: 3.8392 - lr: 2.4660e-05
Epoch 45/100
450/450 [==============================] - 80s 177ms/step - loss: 5.9764 - val_loss: 3.4812 - lr: 2.2313e-05
Epoch 46/100
450/450 [==============================] - 80s 177ms/step - loss: 5.8097 - val_loss: 3.2109 - lr: 2.0190e-05
Epoch 47/100
450/450 [==============================] - 80s 178ms/step - loss: 5.6583 - val_loss: 3.3001 - lr: 1.8268e-05
Epoch 48/100
450/450 [==============================] - 80s 177ms/step - loss: 5.4924 - val_loss: 3.1236 - lr: 1.6530e-05
Epoch 49/100
450/450 [==============================] - 80s 177ms/step - loss: 5.3503 - val_loss: 2.8994 - lr: 1.4957e-05
Epoch 50/100
450/450 [==============================] - 80s 177ms/step - loss: 5.2886 - val_loss: 3.0700 - lr: 1.3534e-05
Epoch 51/100
450/450 [==============================] - 80s 177ms/step - loss: 5.1197 - val_loss: 2.9345 - lr: 1.2246e-05
Epoch 52/100
450/450 [==============================] - 80s 177ms/step - loss: 5.0215 - val_loss: 2.6038 - lr: 1.1080e-05
Epoch 53/100
450/450 [==============================] - 80s 177ms/step - loss: 4.9696 - val_loss: 2.5770 - lr: 1.0026e-05
Epoch 54/100
450/450 [==============================] - 80s 177ms/step - loss: 4.9179 - val_loss: 2.7141 - lr: 9.0718e-06
Epoch 55/100
450/450 [==============================] - 80s 177ms/step - loss: 4.7579 - val_loss: 2.8401 - lr: 8.2085e-06
Epoch 56/100
450/450 [==============================] - 80s 177ms/step - loss: 4.8385 - val_loss: 2.3775 - lr: 7.4273e-06
Epoch 57/100
450/450 [==============================] - 80s 177ms/step - loss: 4.7094 - val_loss: 2.3932 - lr: 6.7205e-06
Epoch 58/100
450/450 [==============================] - 80s 177ms/step - loss: 4.5765 - val_loss: 2.4312 - lr: 6.0810e-06
Epoch 59/100
450/450 [==============================] - 80s 177ms/step - loss: 4.6818 - val_loss: 2.5820 - lr: 5.5023e-06
Epoch 60/100
450/450 [==============================] - 80s 177ms/step - loss: 4.5664 - val_loss: 2.3157 - lr: 4.9787e-06
Epoch 61/100
450/450 [==============================] - 80s 177ms/step - loss: 4.6025 - val_loss: 2.3750 - lr: 4.5049e-06
Epoch 62/100
450/450 [==============================] - 80s 177ms/step - loss: 4.6010 - val_loss: 2.1398 - lr: 4.0762e-06
Epoch 63/100
450/450 [==============================] - 80s 177ms/step - loss: 4.4186 - val_loss: 2.1767 - lr: 3.6883e-06
Epoch 64/100
450/450 [==============================] - 80s 177ms/step - loss: 4.4091 - val_loss: 2.4289 - lr: 3.3373e-06
Epoch 65/100
450/450 [==============================] - 80s 177ms/step - loss: 4.3852 - val_loss: 2.1212 - lr: 3.0197e-06
Epoch 66/100
450/450 [==============================] - 80s 177ms/step - loss: 4.4002 - val_loss: 2.0769 - lr: 2.7324e-06
Epoch 67/100
450/450 [==============================] - 80s 177ms/step - loss: 4.4423 - val_loss: 2.0231 - lr: 2.4723e-06
Epoch 68/100
450/450 [==============================] - 80s 177ms/step - loss: 4.3966 - val_loss: 2.1468 - lr: 2.2371e-06
Epoch 69/100
450/450 [==============================] - 80s 177ms/step - loss: 4.3467 - val_loss: 2.0706 - lr: 2.0242e-06
Epoch 70/100
450/450 [==============================] - 80s 177ms/step - loss: 4.3267 - val_loss: 2.1536 - lr: 1.8316e-06
Epoch 71/100
450/450 [==============================] - 80s 177ms/step - loss: 4.3331 - val_loss: 2.0086 - lr: 1.6573e-06
Epoch 72/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2422 - val_loss: 2.0543 - lr: 1.4996e-06
Epoch 73/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2723 - val_loss: 2.0586 - lr: 1.3569e-06
Epoch 74/100
450/450 [==============================] - 80s 177ms/step - loss: 4.3312 - val_loss: 2.3828 - lr: 1.2277e-06
Epoch 75/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2390 - val_loss: 2.0901 - lr: 1.1109e-06
Epoch 76/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2460 - val_loss: 1.8787 - lr: 1.0052e-06
Epoch 77/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2536 - val_loss: 2.0038 - lr: 9.0953e-07
Epoch 78/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2113 - val_loss: 2.1535 - lr: 8.2297e-07
Epoch 79/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2484 - val_loss: 2.0850 - lr: 7.4466e-07
Epoch 80/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2379 - val_loss: 2.2815 - lr: 6.7379e-07
Epoch 81/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2174 - val_loss: 2.1024 - lr: 6.0967e-07
Epoch 82/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2598 - val_loss: 2.2412 - lr: 5.5165e-07
Epoch 83/100
450/450 [==============================] - 80s 177ms/step - loss: 4.1897 - val_loss: 2.0251 - lr: 4.9916e-07
Epoch 84/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2626 - val_loss: 1.8868 - lr: 4.5166e-07
Epoch 85/100
450/450 [==============================] - 80s 177ms/step - loss: 4.1934 - val_loss: 2.2604 - lr: 4.0868e-07
Epoch 86/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2243 - val_loss: 2.1467 - lr: 3.6979e-07
Epoch 87/100
450/450 [==============================] - 80s 177ms/step - loss: 4.2495 - val_loss: 2.1599 - lr: 3.3460e-07
Epoch 88/100
450/450 [==============================] - 80s 177ms/step - loss: 4.1963 - val_loss: 2.1335 - lr: 3.0275e-07
Epoch 89/100
450/450 [==============================] - 80s 177ms/step - loss: 4.1974 - val_loss: 1.7713 - lr: 2.7394e-07
Epoch 90/100
450/450 [==============================] - 80s 178ms/step - loss: 4.2653 - val_loss: 1.8656 - lr: 2.4787e-07
Epoch 91/100
450/450 [==============================] - 80s 178ms/step - loss: 4.2258 - val_loss: 2.2761 - lr: 2.2429e-07
Epoch 92/100
450/450 [==============================] - 80s 178ms/step - loss: 4.2565 - val_loss: 2.1223 - lr: 2.0294e-07
Epoch 93/100
450/450 [==============================] - 80s 178ms/step - loss: 4.1852 - val_loss: 2.0346 - lr: 1.8363e-07
Epoch 94/100
450/450 [==============================] - 80s 178ms/step - loss: 4.2072 - val_loss: 2.1484 - lr: 1.6616e-07
Epoch 95/100
450/450 [==============================] - 80s 177ms/step - loss: 4.1613 - val_loss: 1.9256 - lr: 1.5034e-07
Epoch 96/100
450/450 [==============================] - 80s 177ms/step - loss: 4.1954 - val_loss: 1.9566 - lr: 1.3604e-07
Epoch 97/100
450/450 [==============================] - 80s 177ms/step - loss: 4.1665 - val_loss: 1.9464 - lr: 1.2309e-07
Epoch 98/100
450/450 [==============================] - 80s 178ms/step - loss: 4.1689 - val_loss: 1.9255 - lr: 1.1138e-07
Epoch 99/100
450/450 [==============================] - 80s 178ms/step - loss: 4.1996 - val_loss: 2.0716 - lr: 1.0078e-07
Epoch 100/100
450/450 [==============================] - 80s 178ms/step - loss: 4.2119 - val_loss: 2.3572 - lr: 9.1188e-08  
"""
def convert_to_json(text):
    lines = text.strip().split("\n")
    data = []
    flat=1
    for i in range(len(lines)):
        line=lines[i]
        if flat ==1:
            epoch = int(line.split("/")[0].split()[-1])
        else:
            loss = float(line.split(":")[1].split('-')[0])
            val_loss = float(line.split(":")[2].split('-')[0])
            data.append({"epoch": (i+1)//2, "loss": loss, "val_loss": val_loss})
        flat = -flat
    #     parts = line.split(" - ")
    #     epoch = int(parts[0].split("/")[0].split()[-1])
    #     loss = float(parts[1].split(":")[-1])
    #     val_loss = float(parts[2].split(":")[-1].split()[0])
    #     lr = float(parts[3].split(":")[-1])
    #     data.append({"epoch": epoch, "loss": loss, "val_loss": val_loss, "lr": lr})
    return json.dumps(data, indent=4)

from matplotlib import pyplot as plt
data=convert_to_json(text)
data = json.loads(data)
epochs = [x['epoch'] for x in data]
loss = [x['loss'] for x in data]
val_loss = [x['val_loss'] for x in data]
plt.plot(epochs, loss, label='loss')
plt.plot(epochs, val_loss, label='val_loss')
plt.xlabel('Epochs')
plt.ylabel('Loss')
plt.legend()
# save plot to file
filename = '../../../images/loss_plot.png'
plt.savefig(filename)
# plt.show()
